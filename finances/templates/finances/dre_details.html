{% extends "scheduler/base.html" %}
{% load humanize %}

{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-lg-between align-items-lg-center text-center text-lg-start gap-3 mb-4">
    <div>
        <h1 class="h3 mb-0">Detalhes da Categoria: {{ category_name }}</h1>
        <p class="text-muted mb-0">
            Exibindo lançamentos no período de {{ start_date|date:"d/m/Y" }} a {{ end_date|date:"d/m/Y" }}.
        </p>
    </div>
    <a href="{% url 'finances:dre_report' %}?start_date={{ start_date }}&end_date={{ end_date }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Voltar para o DRE
    </a>
</div>

<!-- Desktop Table -->
<div class="d-none d-lg-block content-block">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">Descrição</th>
                <th scope="col">Competência</th>
                <th scope="col">{% if modelo == 'receita' %}Recebimento{% else %}Pagamento{% endif %}</th>
                <th scope="col">{% if modelo == 'receita' %}Aluno{% else %}Professor{% endif %}</th>
                <th scope="col" class="text-end">Valor</th>
            </tr>
        </thead>
        <tbody>
            {% for lancamento in lancamentos %}
            <tr>
                <td>{{ lancamento.descricao|title }}</td>
                <td>{{ lancamento.data_competencia|date:"d/m/Y" }}</td>
                <td>
                    {% if modelo == 'receita' %}
                        {{ lancamento.data_recebimento|date:"d/m/Y"|default:"-" }}
                    {% else %}
                        {{ lancamento.data_pagamento|date:"d/m/Y"|default:"-" }}
                    {% endif %}
                </td>
                <td>
                    {% if modelo == 'receita' %}
                        {{ lancamento.aluno.nome_completo|title|default:"-" }}
                    {% else %}
                        {{ lancamento.professor.get_full_name|title|default:"-" }}
                    {% endif %}
                </td>
                <td class="text-end fw-bold">R$ {{ lancamento.valor|floatformat:2|intcomma }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center text-muted p-4">
                    Nenhum lançamento encontrado para esta categoria no período selecionado.
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr class="table-light">
                <td colspan="4" class="text-end fw-bold">TOTAL:</td>
                <td class="text-end h5 mb-0">
                    R$ {{ total_categoria|floatformat:2|intcomma }}
                </td>
            </tr>
        </tfoot>
    </table>
</div>

<!-- Mobile Cards -->
<div class="d-lg-none">
    {% for lancamento in lancamentos %}
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <h6 class="fw-bold mb-2">{{ lancamento.descricao|title }}</h6>
            <div class="d-flex justify-content-between mb-1">
                <span class="text-muted">Competência:</span>
                <span>{{ lancamento.data_competencia|date:"d/m/Y" }}</span>
            </div>
            <div class="d-flex justify-content-between mb-1">
                <span class="text-muted">{% if modelo == 'receita' %}Recebimento{% else %}Pagamento{% endif %}:</span>
                <span>
                    {% if modelo == 'receita' %}
                        {{ lancamento.data_recebimento|date:"d/m/Y"|default:"-" }}
                    {% else %}
                        {{ lancamento.data_pagamento|date:"d/m/Y"|default:"-" }}
                    {% endif %}
                </span>
            </div>
            <div class="d-flex justify-content-between mb-1">
                <span class="text-muted">{% if modelo == 'receita' %}Aluno{% else %}Professor{% endif %}:</span>
                <span>
                    {% if modelo == 'receita' %}
                        {{ lancamento.aluno.nome_completo|title|default:"-" }}
                    {% else %}
                        {{ lancamento.professor.get_full_name|title|default:"-" }}
                    {% endif %}
                </span>
            </div>
            <div class="d-flex justify-content-between fw-bold">
                <span class="text-muted">Valor:</span>
                <span>R$ {{ lancamento.valor|floatformat:2|intcomma }}</span>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center text-muted p-4">
        Nenhum lançamento encontrado para esta categoria no período selecionado.
    </div>
    {% endfor %}

    <!-- Total -->
    <div class="card shadow-sm mb-3 bg-dark text-white p-3 text-end fw-bold">
        TOTAL: R$ {{ total_categoria|floatformat:2|intcomma }}
    </div>
</div>
{% endblock %}