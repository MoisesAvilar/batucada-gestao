{% extends "scheduler/base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ titulo }}</h1>
</div>

{% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
{% endif %}

<div class="card shadow-sm">
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            <div class="mb-3">
                <label for="{{ form.username.id_for_label }}" class="form-label">Nome de Usuário</label>
                {{ form.username }}
                {% if form.username.errors %}<div class="text-danger">{{ form.username.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                {{ form.email }}
                {% if form.email.errors %}<div class="text-danger">{{ form.email.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="{{ form.first_name.id_for_label }}" class="form-label">Primeiro Nome</label>
                {{ form.first_name }}
                {% if form.first_name.errors %}<div class="text-danger">{{ form.first_name.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="{{ form.last_name.id_for_label }}" class="form-label">Sobrenome</label>
                {{ form.last_name }}
                {% if form.last_name.errors %}<div class="text-danger">{{ form.last_name.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="{{ form.tipo.id_for_label }}" class="form-label">Tipo de Usuário</label>
                {{ form.tipo }}
                {% if form.tipo.errors %}<div class="text-danger">{{ form.tipo.errors }}</div>{% endif %}
            </div>
            <div class="mb-3 form-check">
                {{ form.is_active }}
                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">Ativo</label>
                {% if form.is_active.errors %}<div class="text-danger">{{ form.is_active.errors }}</div>{% endif %}
            </div>
            <div class="mb-3 form-check">
                {{ form.is_staff }}
                <label class="form-check-label" for="{{ form.is_staff.id_for_label }}">Permissão de Acesso ao Admin (Staff)</label>
                {% if form.is_staff.errors %}<div class="text-danger">{{ form.is_staff.errors }}</div>{% endif %}
            </div>

            {# Campos de Senha - visíveis apenas na criação ou se houver erro #}
            {% if not form.instance.pk %} {# Apenas mostra na CRIAÇÃO (se não tem PK, é novo) #}
            <div class="mb-3">
                <label for="{{ form.password.id_for_label }}" class="form-label">Senha (apenas para criação)</label>
                {{ form.password }}
                {% if form.password.errors %}<div class="text-danger">{{ form.password.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="{{ form.password_confirm.id_for_label }}" class="form-label">Confirmar Senha</label>
                {{ form.password_confirm }}
                {% if form.password_confirm.errors %}<div class="text-danger">{{ form.password_confirm.errors }}</div>{% endif %}
            </div>
            {% else %} {# Se estiver EDITANDO, e houver erros de senha, mostre-os #}
                {% if form.password.errors or form.password_confirm.errors %}
                <div class="alert alert-warning">
                    <p>Para alterar a senha, preencha os campos abaixo. Deixe em branco para manter a senha atual.</p>
                </div>
                <div class="mb-3">
                    <label for="{{ form.password.id_for_label }}" class="form-label">Nova Senha</label>
                    {{ form.password }}
                    {% if form.password.errors %}<div class="text-danger">{{ form.password.errors }}</div>{% endif %}
                </div>
                <div class="mb-3">
                    <label for="{{ form.password_confirm.id_for_label }}" class="form-label">Confirmar Nova Senha</label>
                    {{ form.password_confirm }}
                    {% if form.password_confirm.errors %}<div class="text-danger">{{ form.password_confirm.errors }}</div>{% endif %}
                </div>
                {% endif %}
            {% endif %}

            <button type="submit" class="btn btn-primary mt-3">Salvar</button>
            <a href="{% url 'scheduler:professor_listar' %}" class="btn btn-secondary mt-3">Cancelar</a>
        </form>
    </div>
</div>
{% endblock %}