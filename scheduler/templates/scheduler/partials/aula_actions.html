{% comment %} scheduler/templates/scheduler/partials/aula_actions.html (CORRIGIDO) {% endcomment %}

{# Lógica para o usuário ADMIN #}
{% if user.tipo == 'admin' %}
    <a href="{% url 'scheduler:aula_editar' aula.pk %}" class="btn btn-sm btn-outline-primary" title="Editar Aula">
        <i class="bi bi-pencil-square"></i>
    </a>
    <a href="{% url 'scheduler:aula_validar' aula.pk %}" class="btn btn-sm btn-outline-info" title="Ver/Editar Relatório">
        <i class="bi bi-file-earmark-text"></i>
    </a>
    <a href="{% url 'scheduler:aula_excluir' aula.pk %}" class="btn btn-sm btn-outline-danger" title="Excluir Aula">
        <i class="bi bi-trash"></i>
    </a>

{# Lógica para o usuário PROFESSOR #}
{% else %} 
    {% if aula.status == 'Agendada' %}
        {# --- CORREÇÃO AQUI --- #}
        {# Verifica se o professor logado está NA LISTA de professores da aula #}
        {% if request.user in aula.professores.all %}
            <a href="{% url 'scheduler:aula_validar' aula.pk %}" class="btn btn-sm btn-success" title="Validar Minha Aula">
                <i class="bi bi-check-circle"></i> Validar Aula
            </a>
        {# Se a aula está agendada para OUTRO professor, ele pode substituir. #}
        {% else %}
            <a href="{% url 'scheduler:aula_validar' aula.pk %}" class="btn btn-sm btn-warning" title="Substituir e Validar">
                <i class="bi bi-person-replace"></i> Substituir
            </a>
        {% endif %}

    {% elif aula.status == 'Realizada' %}
        {# Se a aula já foi realizada, qualquer professor pode ver o relatório. #}
        <a href="{% url 'scheduler:aula_validar' aula.pk %}" class="btn btn-sm btn-outline-info" title="Ver Relatório">
            <i class="bi bi-eye"></i> Ver Relatório
        </a>
    
    {% else %} {# Para status 'Cancelada', 'Aluno Ausente', etc. #}
        <span class="text-muted small">N/A</span>
    {% endif %}
{% endif %}